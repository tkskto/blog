---
layout: ../layout/post.astro
title: 'React-Native開発においてツラいところ'
publishDate: 2018-11-18
tags: ['イベント']
draft: true
---

私はWebの制作会社で働いている開発者だが、たまーにアプリ開発もやる。とはいえ専門ではないので、アプリ関連の情報を収集をメインでやっているわけではない。

React Nativeを使ってアプリ開発している人のなかには自分と同じような人がいるのではないかと思う。

もちろんSwiftやKotlinをゼロから学ぶ必要がないことは大きな特権ではあるものの、だからと言ってアプリ開発の勉強をしなくていいわけではない。

少なくとも以下のようなことは、通して役割や仕組みは知っておいた方がいい。

*   iOSアプリ開発の証明書関連（これは必須）
*   GUI（つまりXCodeやAndroid Studio）での変更がどのファイルに影響を及ぼすのか
*   CocoaPodsやGradle

またReact Nativeは便利である一方、さまざまな方面に気を使う必要があるので大変な一面もある。

*   XCodeのバージョン
*   macOSのバージョン
*   macOSのプロセッサ（M1|Appleシリコン）
*   ターゲットとなるOSのバージョン
*   React Nativeのバージョン
*   Gradleのバージョン（なんならAndroid StudioやJDKのバージョンも）
*   その他ライブラリやパッケージのバージョン

アプリの場合、最新のOSバージョンに対応していないとそもそも審査にすら出せないということもあったりするので、Webみたいにライブラリのバージョンをあげないまま開発ができないのも受託だとなかなかにしんどい。  
（発注がないとライブラリのバージョンアップができないの制作会社がアプリの制作を請け負うなら、定期運用前提で契約をした方がいいと個人的には思う。）

エラーでググっても英語しか出てこないし、情報量はかなり少ない。最終的にSwiftの情報が出てくると正直お手上げだ。

本当はもう少しネイティブの勉強して、なんでそのエラーが出るのかを理解してから着手すべきなんだろうけど、それができるならReact Nativeは無理して使わないと思う。（クロスプラットフォーム開発ができるという点はおいといて）

とはいえ、ググって出てくる解決策をなんも知らず片っ端から適用していくのは、他の箇所に与える副作用が大きすぎる。というか、どこに副作用があるのかわからないので気軽に適用できない。あちらを立てればこちらが立たぬ状態で一向に機能開発が進まない。急がば回れとはよく言ったものだ。

ついでに言うととにかく時間がかかるタスクが多い。

*   インストール系
    *   開発ツールのインストール、アップデート
    *   npmパッケージのインストール
    *   Podsのインストール
*   XCodeのビルド
*   Gradle sync

しかも、うまくいかない場合のよくある解決策が「一回もろもろを消してもう一回インストールしなおす」だったりするので、エラーにハマるたびにまた同じ時間をかけることになる。ツラい。

ついでのついでにいうと、ビルド系のタスクはエネルギーを消費するから電源繋いでおかないと作業できない。

USBポートが二つしかないMacbookで開発してると、AndroidとiOSの実機を同時に繋ぐことができなくなる…。（ハブを買え）

まぁ、文句を言いたいわけではなく、自分のような一端の開発者ができることは、できる限り自分が納得いく状態まで情報をブレイクダウンして、その軌跡を残しておくことなんじゃないだろうか。

というわけで、自分が直面した内容についてはサマリーを残しておく。しかし、もしこれを読んだ人はここに書いてある情報を鵜呑みにすることなく、この情報をきっかけに調べ、その軌跡を自分なりに残しておいて欲しいと思う。

## 開発を進める前にやっておいた方がいいこと

### アップデート

プロジェクトが始まる前に以下をアップデートなりインストールしておく

*   XCode
*   CocoaPod
*   watchman
*   gradle
*   Android SDK

XCodeはインストール、アップデートするのにストレージの空き容量が40GBとか必要になることがあるので、作業直前にやろうとすると、ストレージの容量が足りなくてアップデートできないことがある。計画的にやろう。

CocoaPodやWatchmanはHomebrewなどのパッケージマネージャーで入れていればハマることはないと思う。

### 環境の整理

*   project.pbxprojを整理しておく

自分を含め前任者がテキトーに改修していると、このファイルがめちゃくちゃになる可能性がある。整理しておくとビルド時間短縮に繋がったり、エラー箇所を特定しやすくなる（かもしれない）。

自分の場合はtvOS向けの設定を消したり、重複して参照している部分とかを整理したら`react-native run-ios`でホットリロードが効かない問題とか、画像が表示されない問題が解消した。

### 用意しておくといいコマンド

*   リリース用デプロイコマンド

## 2021年

### arm64関連の話

```
use_flipper!({ 'Flipper' => '0.93.0'})
post_install do |installer|
  react_native_post_instlall(installer)

  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings['IPHONES_DEPLOYMENT_TARGET'] = IOS_VERSION
      config.build_settings['EXCLUDE_ARCHS[sdk=iphonessimulator*]'] = 'arm64'
```

ついでに言うと`IPHONES_DEPLOYMENT_TARGET`も各podsの設定が古いとビルドできないので、無理矢理変更している。これは副作用知らないままやってる。

### XCodeでのビルドはうまくいくのに、npm run iosだとコケる

これはアーキテクチャの問題だったと思う。

### Androidうごかねぇ

React Nativeのバージョンを0.65にあげてたんだけど、Androidで全く動かなかったので、0.64系に戻した。悲しい。
